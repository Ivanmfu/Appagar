(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{9016:function(e,l,r){Promise.resolve().then(r.bind(r,7225))},683:function(e,l,r){"use strict";r.d(l,{Ho:function(){return u},aC:function(){return c}});var s=r(7437),t=r(4316),o=r(6463),n=r(2265);let i=(0,n.createContext)(void 0);async function a(e){var l,r;if(console.log("[ensureProfile] Called with user:",null==e?void 0:e.email),!e)return console.log("[ensureProfile] No user, returning null"),null;let s={id:e.id,email:e.email,display_name:(null===(l=e.user_metadata)||void 0===l?void 0:l.display_name)||(null===(r=e.user_metadata)||void 0===r?void 0:r.full_name)||null};try{let l=(0,t.N)();console.log("[ensureProfile] Fetching profile from DB with 3s timeout...");let r=l.from("profiles").select("id, email, display_name").eq("id",e.id).maybeSingle(),o=new Promise((e,l)=>setTimeout(()=>l(Error("Profile fetch timeout")),3e3)),{data:n,error:i}=await Promise.race([r,o]);if(console.log("[ensureProfile] DB query result:",{existing:n,fetchError:i}),i)return console.error("[Profile] Error fetching profile:",i),console.log("[ensureProfile] Returning fallback after fetch error"),s;if(n)return console.log("[ensureProfile] Profile found:",n),n;console.log("[ensureProfile] No profile found, attempting background create...");let a={id:e.id,email:e.email,display_name:s.display_name};return(0,t.N)().from("profiles").upsert(a).select("id, email, display_name").single().then(e=>{let{data:l,error:r}=e;r?console.error("[Profile] Background upsert error:",r):console.log("[Profile] Background upsert success:",l)}),console.log("[ensureProfile] Returning fallback immediately"),s}catch(e){return console.error("[Profile] Error or timeout:",e),console.log("[ensureProfile] Returning fallback after exception"),s}}function u(e){let{children:l}=e,r=(0,o.useRouter)(),u=(0,o.usePathname)(),[c,d]=(0,n.useState)(null),[f,h]=(0,n.useState)(null),[m,p]=(0,n.useState)(!0),g=(0,n.useRef)(!1),x=(0,n.useMemo)(()=>(0,t.N)(),[]),v=(0,n.useCallback)(async()=>{console.log("[Auth] refresh() called");try{var e,l;let{data:r,error:s}=await x.auth.getSession();if(s){console.error("Error al recuperar la sesi\xf3n",s),d(null),h(null);return}let t=null!==(e=r.session)&&void 0!==e?e:null;d(t);let o=await a(null!==(l=null==t?void 0:t.user)&&void 0!==l?l:null);h(null!=o?o:null)}catch(e){console.error("Error inesperado al recuperar sesi\xf3n:",e),d(null),h(null)}finally{p(!1)}},[x]);(0,n.useEffect)(()=>{if(g.current)return;g.current=!0;let e=!0,l=setTimeout(()=>{e&&(console.warn("[Auth] TIMEOUT: Forcing loading=false after 10 seconds"),p(!1))},1e4);(async()=>{console.log("[Auth] Initializing...");try{var r,s,t,o;let{data:l,error:n}=await x.auth.getSession();if(console.log("[Auth] getSession result:",{hasSession:!!l.session,error:n,userId:null===(s=l.session)||void 0===s?void 0:null===(r=s.user)||void 0===r?void 0:r.id,email:null===(o=l.session)||void 0===o?void 0:null===(t=o.user)||void 0===t?void 0:t.email}),!e)return;if(n&&console.error("[Auth] Error getting session:",n),d(l.session),l.session){console.log("[Auth] User found:",l.session.user.email),console.log("[Auth] Calling ensureProfile...");let e=await a(l.session.user);console.log("[Auth] ensureProfile returned:",e),h(e),console.log("[Auth] Profile loaded and state updated")}}catch(e){console.error("[Auth] Error in initialize:",e)}finally{clearTimeout(l),e&&(console.log("[Auth] Setting loading=false"),p(!1))}})();let{data:r}=x.auth.onAuthStateChange(async(l,r)=>{if(e){console.log("[Auth] Event:",l,"Has session:",!!r);try{if(d(r),null==r?void 0:r.user){console.log("[Auth] Loading profile for:",r.user.email);let e=await a(r.user);h(e),console.log("[Auth] Profile loaded in event handler")}else h(null)}catch(e){console.error("[Auth] Error in event handler:",e)}finally{console.log("[Auth] Event handler setting loading=false"),p(!1)}}});return()=>{e=!1,r.subscription.unsubscribe()}},[x]),(0,n.useEffect)(()=>{!m&&(c||"/login"===u?c&&"/login"===u&&r.replace("/"):r.replace("/login"))},[u,c,m,r]);let b=(0,n.useMemo)(()=>{var e;return{session:c,user:null!==(e=null==c?void 0:c.user)&&void 0!==e?e:null,profile:f,loading:m,refresh:v}},[c,f,m,v]);return(0,s.jsx)(i.Provider,{value:b,children:l})}function c(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth debe usarse dentro de un AuthProvider");return e}l.ZP=function(e){let{children:l}=e,{loading:r,user:t}=c(),i=(0,o.useRouter)();return((0,n.useEffect)(()=>{console.log("AuthGate - loading:",r,"user:",!!t),r||t||(console.log("AuthGate - Redirigiendo a login"),i.replace("/login"))},[r,t,i]),r)?(0,s.jsxs)("div",{className:"p-6 text-center space-y-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("div",{className:"text-gray-500",children:"Comprobando sesi\xf3n..."}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Si esto tarda mucho, recarga la p\xe1gina"})]}):t?(0,s.jsx)(s.Fragment,{children:l}):null}},7225:function(e,l,r){"use strict";r.d(l,{default:function(){return u}});var s=r(7437),t=r(683),o=r(7138),n=r(6463),i=r(2265);let a=[{href:"/",label:"Inicio"},{href:"/amigos",label:"Amigos"},{href:"/grupos",label:"Grupos"},{href:"/actividad",label:"Actividad"},{href:"/cuenta",label:"Cuenta"}];function u(e){var l,r,u,c;let{children:d}=e,f=(0,n.usePathname)(),h=(0,n.useRouter)(),{profile:m,user:p}=(0,t.aC)(),g=(0,i.useMemo)(()=>{var e;if(!f||"/"===f)return"/";let l=a.find(e=>"/"!==e.href&&f.startsWith(e.href));return null!==(e=null==l?void 0:l.href)&&void 0!==e?e:"/"},[f]);return(0,s.jsx)(t.ZP,{children:(0,s.jsxs)("div",{className:"relative min-h-screen overflow-hidden bg-slate-950 text-slate-100",children:[(0,s.jsxs)("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute -top-40 left-1/2 h-[28rem] w-[28rem] -translate-x-1/2 rounded-full bg-purple-500/30 blur-3xl"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 h-80 w-80 rounded-full bg-blue-600/20 blur-3xl"}),(0,s.jsx)("div",{className:"absolute -bottom-24 right-12 h-72 w-72 rounded-full bg-emerald-500/20 blur-3xl"}),(0,s.jsx)("div",{className:"absolute top-24 right-0 h-64 w-64 rounded-full bg-cyan-400/10 blur-2xl"})]}),(0,s.jsxs)("div",{className:"relative mx-auto flex min-h-screen w-full max-w-6xl flex-col px-4 pb-28 pt-8 sm:px-6 lg:px-8",children:[(0,s.jsxs)("header",{className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.35em] text-slate-300",children:"Appagar"}),(0,s.jsx)("h1",{className:"mt-2 text-3xl font-semibold text-white sm:text-4xl",children:null!==(r=null!==(l=null==m?void 0:m.display_name)&&void 0!==l?l:null==p?void 0:p.email)&&void 0!==r?r:"Compa\xf1ero/a"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-slate-300",children:"Organiza tus gastos compartidos sin perder estilo."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 rounded-full border border-white/10 bg-white/10 px-4 py-2 backdrop-blur-xl",children:[(0,s.jsx)("span",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/10 text-lg font-semibold text-white",children:(null!==(c=null!==(u=null==m?void 0:m.display_name)&&void 0!==u?u:null==p?void 0:p.email)&&void 0!==c?c:"A").slice(0,1).toUpperCase()}),(0,s.jsxs)("div",{className:"text-xs text-slate-300",children:[(0,s.jsx)("p",{className:"font-medium text-white/90",children:"Sesi\xf3n activa"}),(0,s.jsx)("p",{children:null==p?void 0:p.email})]})]})]}),(0,s.jsx)("main",{className:"flex-1",children:(0,s.jsx)("div",{className:"space-y-6 pb-14",children:d})})]}),(0,s.jsx)("nav",{className:"fixed bottom-6 left-1/2 z-20 w-[clamp(18rem,90vw,28rem)] -translate-x-1/2 rounded-full border border-white/10 bg-white/10 px-3 py-2 backdrop-blur-xl",children:(0,s.jsx)("ul",{className:"flex items-center justify-between text-xs font-medium",children:a.map(e=>{let l=g===e.href;return(0,s.jsx)("li",{className:"flex-1",children:(0,s.jsx)(o.default,{className:"flex flex-col items-center gap-1 rounded-full px-3 py-2 transition ".concat(l?"bg-white/20 text-white shadow-lg shadow-white/10":"text-slate-300 hover:text-white"),href:e.href,children:(0,s.jsx)("span",{children:e.label})})},e.href)})})}),(0,s.jsx)("button",{"aria-label":"Crear nuevo grupo",className:"fixed bottom-28 right-6 z-30 flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-3xl font-semibold text-white shadow-2xl shadow-purple-500/30 transition hover:scale-105 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white md:right-10",onClick:()=>h.push("/grupos?crear=1"),type:"button",children:"+"})]})})}},4316:function(e,l,r){"use strict";r.d(l,{N:function(){return o}});var s=r(46);let t=globalThis;function o(){let e="https://hlhcpdymkqhqpsaafthm.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhsaGNwZHlta3FocXBzYWFmdGhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NDA0MTgsImV4cCI6MjA3ODExNjQxOH0.H_6vnlgCcT_gxmKK9MSOpI9w-p49VnsTV5WZtNcAmys";if(!e||!l)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables");return t.__supabaseClient||(t.__supabaseClient=(0,s.eI)(e,l,{auth:{persistSession:!0,autoRefreshToken:!0,flowType:"pkce",detectSessionInUrl:!0,storage:window.localStorage,storageKey:"appagar-auth"},global:{headers:{"x-client-info":"appagar-web"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:2}}})),t.__supabaseClient}}},function(e){e.O(0,[543,138,971,23,744],function(){return e(e.s=9016)}),_N_E=e.O()}]);