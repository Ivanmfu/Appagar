(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{6960:function(e,t,a){Promise.resolve().then(a.bind(a,4722))},4722:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var i=a(7437),r=a(683),s=a(6294),n=a(1446),l=a(5118),o=a(7138),d=a(2265);let u="rounded-3xl border border-white/10 bg-white/10 p-6 backdrop-blur-xl shadow-xl shadow-black/20";function c(){var e,t,a,c;let{user:m,profile:p}=(0,r.aC)(),x=(0,l.a)({queryKey:["groups",null==m?void 0:m.id],enabled:!!(null==m?void 0:m.id),queryFn:async()=>(null==m?void 0:m.id)?(0,s.a_)(m.id):[]}),h=(0,l.a)({queryKey:["invites",null!==(t=null==p?void 0:p.email)&&void 0!==t?t:null==m?void 0:m.email],enabled:!!(null!==(a=null==p?void 0:p.email)&&void 0!==a?a:null==m?void 0:m.email),queryFn:async()=>{var e;let t=null!==(e=null==p?void 0:p.email)&&void 0!==e?e:null==m?void 0:m.email;return t?(0,n.e$)(t):[]}}),f=(0,d.useMemo)(()=>x.data&&0!==x.data.length?x.data.map(e=>e.id).sort().join("|"):null,[x.data]),v=(0,l.a)({queryKey:["friends",null==m?void 0:m.id,f],enabled:!!((null==m?void 0:m.id)&&f),queryFn:async()=>{if(!(null==m?void 0:m.id)||!x.data)return[];let e=await Promise.all(x.data.map(e=>(0,s.JM)(e.id))),t=new Map;return e.forEach(e=>{e.members.forEach(e=>{e.userId===m.id||t.has(e.userId)||t.set(e.userId,{userId:e.userId,displayName:e.displayName,email:e.email})})}),Array.from(t.values())}});return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("section",{className:"".concat(u," space-y-4"),children:[(0,i.jsxs)("header",{className:"space-y-2",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Personas con las que compartes gastos"}),(0,i.jsx)("p",{className:"text-sm text-slate-200/80",children:"La lista se genera autom\xe1ticamente a partir de los miembros de tus grupos activos."})]}),v.isFetching&&(0,i.jsx)("p",{className:"text-sm text-slate-300",children:"Actualizando contactos..."}),v.data&&v.data.length>0?(0,i.jsx)("ul",{className:"grid gap-3 md:grid-cols-2",children:v.data.map(e=>{var t,a;return(0,i.jsxs)("li",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,i.jsx)("p",{className:"text-sm font-semibold text-white",children:null!==(a=null!==(t=e.displayName)&&void 0!==t?t:e.email)&&void 0!==a?a:"Integrante"}),e.email&&(0,i.jsx)("p",{className:"text-xs text-slate-300",children:e.email})]},e.userId)})}):!v.isFetching&&(0,i.jsx)("div",{className:"rounded-2xl border border-dashed border-white/20 p-6 text-center text-sm text-slate-200/80",children:"Todav\xeda no has compartido gastos con nadie. Crea un grupo e invita a tus amigos para empezar."})]}),(0,i.jsxs)("section",{className:"".concat(u," space-y-4"),children:[(0,i.jsxs)("header",{className:"flex items-center justify-between",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Invitaciones enviadas"}),(0,i.jsxs)("span",{className:"text-xs text-slate-300",children:[null!==(c=null===(e=h.data)||void 0===e?void 0:e.length)&&void 0!==c?c:0," en curso"]})]}),h.isLoading&&(0,i.jsx)("p",{className:"text-sm text-slate-300",children:"Buscando invitaciones..."}),h.data&&h.data.length>0?(0,i.jsx)("ul",{className:"space-y-3 text-sm text-slate-100",children:h.data.map(e=>(0,i.jsxs)("li",{className:"flex items-center justify-between rounded-2xl border border-white/10 bg-white/5 px-4 py-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium text-white",children:e.email}),(0,i.jsxs)("p",{className:"text-xs text-slate-300",children:["Expira ",function(e){if(!e)return"—";try{return new Date(e).toLocaleDateString()}catch(e){return"—"}}(e.expiresAt)]})]}),(0,i.jsx)(o.default,{className:"text-xs font-semibold text-indigo-200 underline-offset-2 hover:text-white hover:underline",href:"/invite?token=".concat(e.token),children:"Detalles"})]},e.id))}):!h.isLoading&&(0,i.jsx)("p",{className:"text-sm text-slate-200/80",children:"No tienes invitaciones enviadas desde tu correo."})]})]})}},1446:function(e,t,a){"use strict";a.d(t,{O$:function(){return s},Ol:function(){return l},Zn:function(){return r},e$:function(){return n}});var i=a(4316);async function r(e){let{groupId:t,email:a,createdBy:r,expiresInHours:s=48}=e;if(!a.trim())throw Error("Introduce un email para invitar");let n=(0,i.N)(),l=a.trim().toLowerCase(),o=crypto.randomUUID(),d=new Date(Date.now()+36e5*s).toISOString(),{data:u,error:c}=await n.from("group_invites").insert({group_id:t,email:l,token:o,status:"pending",expires_at:d,created_by:r}).select().single();if(c)throw c;return u}async function s(e){if(!e.trim())return null;let t=(0,i.N)(),{data:a,error:r}=await t.from("group_invites").select("id, group_id, email, status, token, expires_at, created_at").eq("token",e).maybeSingle();if(r)throw r;return a}async function n(e){if(!e)return[];let t=(0,i.N)(),a=new Date().toISOString(),{data:r,error:s}=await t.from("group_invites").select("id, group_id, email, status, token, expires_at, created_at").eq("email",e.toLowerCase()).eq("status","pending").gt("expires_at",a).order("created_at",{ascending:!1}).limit(20);if(s)throw s;return(null!=r?r:[]).map(e=>{var t,a;return{id:e.id,groupId:e.group_id,email:e.email,status:e.status,token:e.token,expiresAt:null!==(t=e.expires_at)&&void 0!==t?t:null,createdAt:null!==(a=e.created_at)&&void 0!==a?a:null}})}async function l(e){let{token:t,userId:a}=e,r=(0,i.N)(),n=await s(t);if(!n)throw Error("La invitaci\xf3n no existe o ya fue utilizada");if("pending"!==n.status)throw Error("Esta invitaci\xf3n ya no est\xe1 disponible");if(n.expires_at&&new Date(n.expires_at)<new Date)throw Error("La invitaci\xf3n ha expirado");let{data:l,error:o}=await r.from("group_members").select("id, is_active").eq("group_id",n.group_id).eq("user_id",a).maybeSingle();if(o)throw o;if(l){if(!l.is_active){let{error:e}=await r.from("group_members").update({is_active:!0}).eq("id",l.id);if(e)throw e}}else{let{error:e}=await r.from("group_members").insert({group_id:n.group_id,user_id:a,is_active:!0});if(e)throw e}let{error:d}=await r.from("group_invites").update({status:"accepted"}).eq("id",n.id);if(d)throw d;return n.group_id}}},function(e){e.O(0,[543,973,586,194,971,23,744],function(){return e(e.s=6960)}),_N_E=e.O()}]);