(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[198],{7890:function(e,t,s){Promise.resolve().then(s.bind(s,6674))},6674:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var i=s(7437),a=s(683),r=s(6294),n=s(1446),l=s(5118),d=s(7138),o=s(2265);let c="rounded-3xl border border-white/10 bg-white/10 p-6 backdrop-blur-xl shadow-xl shadow-black/20";function u(e){if(!e)return"—";try{return new Date(e).toLocaleDateString()}catch(e){return"—"}}function x(){var e,t,s,x,m,h,p,v,f,g,w;let{user:b,profile:N}=(0,a.aC)(),j=(0,l.a)({queryKey:["groups",null==b?void 0:b.id],enabled:!!(null==b?void 0:b.id),queryFn:async()=>(null==b?void 0:b.id)?(0,r.a_)(b.id):[]}),_=(0,l.a)({queryKey:["invites",null!==(m=null==N?void 0:N.email)&&void 0!==m?m:null==b?void 0:b.email],enabled:!!(null!==(h=null==N?void 0:N.email)&&void 0!==h?h:null==b?void 0:b.email),queryFn:async()=>{var e;let t=null!==(e=null==N?void 0:N.email)&&void 0!==e?e:null==b?void 0:b.email;return t?(0,n.e$)(t):[]}}),y=(0,o.useMemo)(()=>{var e;return(null!==(e=j.data)&&void 0!==e?e:[]).slice(0,4)},[j.data]);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("section",{className:"".concat(c," grid gap-6 md:grid-cols-[3fr,2fr]"),children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Bienvenido/a de nuevo"}),(0,i.jsx)("p",{className:"text-sm text-slate-200/80",children:"Accede r\xe1pido a tus grupos activos, revisa invitaciones pendientes o registra un nuevo gasto sin perder detalle."}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,i.jsx)(d.default,{className:"rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 px-5 py-2 text-sm font-medium text-white shadow-lg shadow-purple-500/30 transition hover:scale-105",href:"/grupos",children:"Ir a mis grupos"}),(0,i.jsx)(d.default,{className:"rounded-full border border-white/20 px-5 py-2 text-sm font-medium text-white/90 transition hover:border-white/40 hover:text-white",href:"/actividad",children:"Revisar actividad"})]})]}),(0,i.jsxs)("dl",{className:"grid grid-cols-2 gap-4 text-sm text-slate-200/80",children:[(0,i.jsxs)("div",{className:"rounded-2xl bg-white/5 p-4 shadow-inner shadow-black/40",children:[(0,i.jsx)("dt",{className:"text-xs uppercase tracking-[0.25em] text-slate-300",children:"Grupos"}),(0,i.jsx)("dd",{className:"mt-2 text-3xl font-semibold text-white",children:null!==(p=null===(e=j.data)||void 0===e?void 0:e.length)&&void 0!==p?p:0}),(0,i.jsx)("p",{className:"mt-1 text-xs text-slate-300",children:"Activos en tu cuenta"})]}),(0,i.jsxs)("div",{className:"rounded-2xl bg-white/5 p-4 shadow-inner shadow-black/40",children:[(0,i.jsx)("dt",{className:"text-xs uppercase tracking-[0.25em] text-slate-300",children:"Invitaciones"}),(0,i.jsx)("dd",{className:"mt-2 text-3xl font-semibold text-white",children:null!==(v=null===(t=_.data)||void 0===t?void 0:t.length)&&void 0!==v?v:0}),(0,i.jsx)("p",{className:"mt-1 text-xs text-slate-300",children:"Pendientes de respuesta"})]})]})]}),(0,i.jsxs)("section",{className:"".concat(c," space-y-5"),children:[(0,i.jsxs)("header",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Tus grupos destacados"}),(0,i.jsx)("p",{className:"text-sm text-slate-200/80",children:"Accede a los m\xe1s activos o crea uno nuevo."})]}),(0,i.jsx)(d.default,{className:"text-sm font-medium text-white/80 underline-offset-4 hover:text-white hover:underline",href:"/grupos",children:"Ver todos"})]}),j.isLoading&&(0,i.jsx)("p",{className:"text-sm text-slate-300",children:"Cargando grupos..."}),j.error&&(0,i.jsx)("p",{className:"text-sm text-red-300",children:null!==(f=j.error.message)&&void 0!==f?f:"No se pudieron cargar los grupos"}),y.length>0?(0,i.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:y.map(e=>(0,i.jsxs)(d.default,{className:"group rounded-2xl border border-white/10 bg-white/5 p-4 transition hover:border-white/30 hover:bg-white/10",href:"/grupos/detalle?id=".concat(e.id),children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-base font-semibold text-white",children:e.name}),(0,i.jsxs)("span",{className:"text-xs text-slate-200/70",children:[e.memberCount," miembros"]})]}),(0,i.jsxs)("p",{className:"mt-2 text-xs text-slate-300",children:["Creado ",u(e.createdAt)]}),(0,i.jsxs)("p",{className:"mt-1 text-xs text-slate-200/70",children:["\xdaltimo movimiento ",u(e.lastExpenseAt)," \xb7 Base ",e.baseCurrency]})]},e.id))}):!j.isLoading&&(0,i.jsx)("div",{className:"rounded-2xl border border-dashed border-white/20 p-6 text-center text-sm text-slate-200/70",children:"A\xfan no perteneces a ning\xfan grupo. Usa el bot\xf3n flotante para registrar tu primer gasto una vez que formes uno."})]}),(0,i.jsxs)("section",{className:"".concat(c," space-y-4"),children:[(0,i.jsxs)("header",{className:"flex items-center justify-between",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Invitaciones recientes"}),(0,i.jsxs)("span",{className:"text-xs text-slate-300",children:[null!==(g=null===(s=_.data)||void 0===s?void 0:s.length)&&void 0!==g?g:0," activas"]})]}),_.isLoading&&(0,i.jsx)("p",{className:"text-sm text-slate-300",children:"Buscando invitaciones..."}),!_.isLoading&&(null!==(w=null===(x=_.data)||void 0===x?void 0:x.length)&&void 0!==w?w:0)===0&&(0,i.jsx)("p",{className:"text-sm text-slate-200/70",children:"No tienes invitaciones pendientes por ahora."}),_.data&&_.data.length>0&&(0,i.jsx)("ul",{className:"space-y-3 text-sm text-slate-100",children:_.data.map(e=>(0,i.jsxs)("li",{className:"flex items-center justify-between rounded-2xl border border-white/10 bg-white/5 px-4 py-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{className:"font-medium text-white",children:["Invitaci\xf3n para ",e.email]}),(0,i.jsxs)("p",{className:"text-xs text-slate-300",children:["Expira ",u(e.expiresAt)]})]}),(0,i.jsx)(d.default,{className:"text-xs font-semibold text-indigo-200 underline-offset-2 hover:text-white hover:underline",href:"/invite?token=".concat(e.token),children:"Ver enlace"})]},e.id))})]})]})}},1446:function(e,t,s){"use strict";s.d(t,{O$:function(){return r},Ol:function(){return l},Zn:function(){return a},e$:function(){return n}});var i=s(4316);async function a(e){let{groupId:t,email:s,createdBy:a,expiresInHours:r=48}=e;if(!s.trim())throw Error("Introduce un email para invitar");let n=(0,i.N)(),l=s.trim().toLowerCase(),d=crypto.randomUUID(),o=new Date(Date.now()+36e5*r).toISOString(),{data:c,error:u}=await n.from("group_invites").insert({group_id:t,email:l,token:d,status:"pending",expires_at:o,created_by:a}).select().single();if(u)throw u;return c}async function r(e){if(!e.trim())return null;let t=(0,i.N)(),{data:s,error:a}=await t.from("group_invites").select("id, group_id, email, status, token, expires_at, created_at").eq("token",e).maybeSingle();if(a)throw a;return s}async function n(e){if(!e)return[];let t=(0,i.N)(),s=new Date().toISOString(),{data:a,error:r}=await t.from("group_invites").select("id, group_id, email, status, token, expires_at, created_at").eq("email",e.toLowerCase()).eq("status","pending").gt("expires_at",s).order("created_at",{ascending:!1}).limit(20);if(r)throw r;return(null!=a?a:[]).map(e=>{var t,s;return{id:e.id,groupId:e.group_id,email:e.email,status:e.status,token:e.token,expiresAt:null!==(t=e.expires_at)&&void 0!==t?t:null,createdAt:null!==(s=e.created_at)&&void 0!==s?s:null}})}async function l(e){let{token:t,userId:s}=e,a=(0,i.N)(),n=await r(t);if(!n)throw Error("La invitaci\xf3n no existe o ya fue utilizada");if("pending"!==n.status)throw Error("Esta invitaci\xf3n ya no est\xe1 disponible");if(n.expires_at&&new Date(n.expires_at)<new Date)throw Error("La invitaci\xf3n ha expirado");let{data:l,error:d}=await a.from("group_members").select("id, is_active").eq("group_id",n.group_id).eq("user_id",s).maybeSingle();if(d)throw d;if(l){if(!l.is_active){let{error:e}=await a.from("group_members").update({is_active:!0}).eq("id",l.id);if(e)throw e}}else{let{error:e}=await a.from("group_members").insert({group_id:n.group_id,user_id:s,is_active:!0});if(e)throw e}let{error:o}=await a.from("group_invites").update({status:"accepted"}).eq("id",n.id);if(o)throw o;return n.group_id}}},function(e){e.O(0,[543,973,586,194,971,23,744],function(){return e(e.s=7890)}),_N_E=e.O()}]);